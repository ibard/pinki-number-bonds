<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Part-Whole Number Bonds</title>
  <style>
    /* Overall Page Style with a pinkish, cute palette */
    body {
      margin: 0;
      padding: 0;
      font-family: "Helvetica Neue", Arial, sans-serif;
      background: #ffe6f2; /* soft pink background */
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      min-height: 100vh;
    }
    
    h1 {
      margin-top: 20px;
      color: #d6336c;
      text-align: center;
    }

    /* Main game container */
    .game-container {
      margin-top: 20px;
      background: #fff0f5;
      border-radius: 15px;
      width: 90%;
      max-width: 500px;
      box-shadow: 0 8px 16px rgba(0,0,0,0.2);
      padding: 20px;
      text-align: center;
      position: relative;
    }

    /* Diagram container for the part-whole diagram */
    .diagram-container {
      margin: 20px auto;
      width: 250px;
    }
    
    /* Equation container */
    .equation-container {
      margin: 20px auto;
      font-size: 2.5rem;
      color: #d6336c;
      font-weight: bold;
      display: none; /* hidden by default */
    }

    /* The whole circle (top) */
    .circle.whole {
      width: 80px;
      height: 80px;
      border-radius: 50%;
      background-color: #f8bbd0;
      border: 3px solid #d6336c;
      margin: 0 auto;
      font-size: 2rem;
      line-height: 80px;
      color: #d6336c;
    }
    
    /* Container for the parts (lower circles) */
    .parts {
      display: flex;
      justify-content: space-around;
      margin-top: 20px;
    }
    
    /* Each part circle */
    .circle.part {
      width: 60px;
      height: 60px;
      border-radius: 50%;
      background-color: #f8bbd0;
      border: 3px solid #d6336c;
      font-size: 1.5rem;
      line-height: 60px;
      color: #d6336c;
    }
    
    /* When a circle is "empty" (i.e. the missing number) */
    .empty {
      background-color: #fff;
      color: transparent;
    }

    /* Options container */
    .options {
      display: flex;
      flex-wrap: wrap;
      justify-content: center;
      gap: 10px;
      margin: 20px 0;
    }

    .option-button {
      background: #ff80ab;
      color: white;
      border: none;
      border-radius: 8px;
      padding: 10px 15px;
      font-size: 1.2rem;
      cursor: pointer;
      flex: 1 1 30%;
      max-width: 120px;
      transition: background 0.3s;
    }

    .option-button:hover {
      background: #ff4081;
    }

    /* Feedback image - now centered and 2x bigger */
    #feedbackImage {
      display: block;
      margin: 10px auto;
      width: 300px; /* increased width */
      height: auto;
      display: none;
    }

    /* Score display */
    .score {
      margin-top: 20px;
      font-size: 1.2rem;
      color: #d6336c;
    }

    /* Celebrate animation for 5 consecutive correct answers */
    .celebrate-effect {
      animation: celebrateAnim 1s ease-out;
    }

    @keyframes celebrateAnim {
      0%   { transform: scale(1); }
      50%  { transform: scale(1.2); }
      100% { transform: scale(1); }
    }

    /* --- New Styles for the Rainbow Unicorn Puzzle --- */
    /* 
       The original reward image is 1536×1024 (aspect ratio 1.5).  
       We set the puzzle container to 300×200, which keeps the same ratio.
       The grid is 6 columns × 4 rows; therefore each tile shows 1/6 of the width 
       and 1/4 of the height. The background-size "600% 400%" splits the image accordingly.
    */
    #rainbowPuzzle {
      width: 300px;
      height: 200px;
      display: grid;
      grid-template-columns: repeat(6, 1fr);
      grid-template-rows: repeat(4, 1fr);
      gap: 1px;
      border: 2px solid #000;
      margin: 20px auto;
    }
    .rainbow-tile {
      background-image: url('rainbow-unicorn.jpeg');
      background-size: 600% 400%;
      visibility: hidden;
    }
  </style>
</head>
<body>
  <h1>Pinki's Number Bonds</h1>
  
  <div class="game-container" id="gameContainer">
    <!-- Diagram Container -->
    <div class="diagram-container" id="diagramContainer">
      <!-- Whole number (top circle) -->
      <div class="circle whole" id="wholeCircle"></div>
      <!-- Lower parts -->
      <div class="parts">
        <div class="circle part" id="part1Circle"></div>
        <div class="circle part" id="part2Circle"></div>
      </div>
    </div>

    <!-- Equation Container (hidden by default) -->
    <div class="equation-container" id="equationContainer">
      <!-- Equation text will be generated dynamically -->
    </div>

    <!-- Options Buttons -->
    <div class="options" id="optionsContainer">
      <!-- Buttons will be generated dynamically -->
    </div>

    <!-- Feedback Image -->
    <img id="feedbackImage" alt="Feedback Image">

    <!-- Score -->
    <div class="score" id="scoreText">Score: 0 / 0</div>

    <!-- Rainbow Unicorn Puzzle (Image Reveal) -->
    <div id="rainbowPuzzle"></div>
  </div>

  <script>
    // --- Configuration & Global Variables ---
    // We'll create two types of problems: "addition" and "subtraction"
    let problemType = "";
    let correctAnswer = 0;
    let score = 0;
    let consecutiveCorrect = 0;
    // New variable to control the display mode: "diagram" or "equation"
    let displayMode = "";
    // Count total questions attempted
    let totalQuestions = 0;

    // Variables for the rainbow unicorn puzzle
    let revealedTiles = 0;
    const totalTiles = 24;
    // Array to hold a random order of tile indices
    let tileOrder = [];

    // Image arrays – ensure these files are available in your project folder
    const happyImages = [
      "happy-uni1.jpeg",
      "happy-uni2.jpeg",
      "happy-uni3.jpeg",
      "happy-uni4.jpeg",
      "happy-uni5.jpeg",
      "happy-uni6.jpeg",
      "happy-uni7.jpeg"
    ];

    const sadImages = [
      "sad-uni1.jpeg"
    ];

    // --- Utility Functions ---
    // Returns a random integer between min and max (inclusive)
    function randomInt(min, max) {
      return Math.floor(Math.random() * (max - min + 1)) + min;
    }

    // Shuffle an array (Fisher–Yates shuffle)
    function shuffleArray(array) {
      for (let i = array.length - 1; i > 0; i--) {
        const j = randomInt(0, i);
        [array[i], array[j]] = [array[j], array[i]];
      }
      return array;
    }

    // Randomly pick an image URL from an array
    function pickRandomImage(arr) {
      return arr[randomInt(0, arr.length - 1)];
    }

    // --- Rainbow Puzzle Initialization ---
    function initializeRainbowPuzzle() {
      const puzzle = document.getElementById('rainbowPuzzle');
      puzzle.innerHTML = ""; // Clear any existing tiles
      revealedTiles = 0;     // Reset the revealed tile counter
      tileOrder = [];        // Reset the random order array

      // Create 24 tiles in a 6×4 grid
      for (let i = 0; i < totalTiles; i++) {
        tileOrder.push(i);
        let tile = document.createElement('div');
        tile.classList.add('rainbow-tile');
        // Determine the tile's row and column (6 columns, 4 rows)
        const col = i % 6;
        const row = Math.floor(i / 6);
        // Set background-position so that when all tiles are visible the image is complete.
        tile.style.backgroundPosition = (-col * 100) + '% ' + (-row * 100) + '%';
        puzzle.appendChild(tile);
      }
      // Shuffle the tileOrder array so tiles are revealed in a random order.
      tileOrder = shuffleArray(tileOrder);
    }

    // --- Problem Generation ---
    function generateProblem() {
      // Randomly choose the display mode: diagram or equation (50/50 chance)
      displayMode = randomInt(0, 1) === 0 ? "diagram" : "equation";

      // Get references to the diagram and equation containers
      const diagramContainer = document.getElementById("diagramContainer");
      const equationContainer = document.getElementById("equationContainer");
      const optionsContainer = document.getElementById("optionsContainer");
      // Ensure options are visible
      optionsContainer.style.display = "flex";
      // Hide feedback image
      document.getElementById("feedbackImage").style.display = "none";

      if (displayMode === "diagram") {
        // Show diagram container and hide equation container
        diagramContainer.style.display = "block";
        equationContainer.style.display = "none";

        // Randomly decide between an addition or subtraction problem (50/50 chance)
        problemType = randomInt(0, 1) === 0 ? "addition" : "subtraction";

        // Get references to our diagram circles
        const wholeCircle = document.getElementById("wholeCircle");
        const part1Circle = document.getElementById("part1Circle");
        const part2Circle = document.getElementById("part2Circle");

        if (problemType === "addition") {
          // For addition:
          // - Two lower circles are filled with numbers.
          // - The top circle (whole) is empty.
          let num1 = randomInt(1, 9);
          let num2 = randomInt(1, 9);
          correctAnswer = num1 + num2;
          // Set diagram:
          wholeCircle.textContent = ""; 
          wholeCircle.classList.add("empty");
          part1Circle.textContent = num1;
          part1Circle.classList.remove("empty");
          part2Circle.textContent = num2;
          part2Circle.classList.remove("empty");
        } else {
          // For subtraction:
          // - The top circle (whole) and one lower circle are filled.
          // - The other lower circle is empty.
          let known = randomInt(1, 9);
          let missing = randomInt(1, 9);
          let whole = known + missing;
          correctAnswer = missing; // the missing part is what the child must find

          // Set the top circle to whole.
          wholeCircle.textContent = whole;
          wholeCircle.classList.remove("empty");

          // Randomly assign the known number to one of the two lower circles.
          if (randomInt(0, 1) === 0) {
            part1Circle.textContent = known;
            part1Circle.classList.remove("empty");
            part2Circle.textContent = "";
            part2Circle.classList.add("empty");
          } else {
            part2Circle.textContent = known;
            part2Circle.classList.remove("empty");
            part1Circle.textContent = "";
            part1Circle.classList.add("empty");
          }
        }
      } else {
        // Equation mode:
        // Hide diagram container and show equation container.
        diagramContainer.style.display = "none";
        equationContainer.style.display = "block";

        // Randomly decide between addition and subtraction.
        problemType = randomInt(0, 1) === 0 ? "addition" : "subtraction";

        let equationText = "";
        if (problemType === "addition") {
          // For equation addition, let’s display: "num1 + ❤️ = sum"
          let num1 = randomInt(1, 9);
          let num2 = randomInt(1, 9);
          correctAnswer = num2; // missing addend
          equationText = `${num1} + ❤️ = ${num1 + num2}`;
        } else {
          // For equation subtraction, display: "whole - ❤️ = known"
          let known = randomInt(1, 9);
          let missing = randomInt(1, 9);
          let whole = known + missing;
          correctAnswer = missing; // missing number
          equationText = `${whole} - ❤️ = ${known}`;
        }
        // Set the equation text in the container.
        equationContainer.textContent = equationText;
      }

      // Generate options for multiple choice.
      generateOptions(correctAnswer);
    }

    function generateOptions(correctAnswer) {
      const optionsContainer = document.getElementById("optionsContainer");
      optionsContainer.innerHTML = ""; // Clear previous options

      // Create a set for unique options and add the correct answer.
      const optionsSet = new Set();
      optionsSet.add(correctAnswer);

      // We'll generate two distractor options.
      // For addition problems, the sum can range roughly from 2 to 18.
      // For subtraction, the missing part will be between 1 and 9.
      let min = problemType === "addition" ? 2 : 1;
      let max = problemType === "addition" ? 18 : 9;
      while (optionsSet.size < 3) {
        let option = randomInt(min, max);
        optionsSet.add(option);
      }

      // Shuffle the options and create button elements.
      const optionsArray = shuffleArray(Array.from(optionsSet));
      optionsArray.forEach(option => {
        const button = document.createElement("button");
        button.className = "option-button";
        button.textContent = option;
        button.onclick = () => checkAnswer(option);
        optionsContainer.appendChild(button);
      });
    }

    // --- Answer Checking & Feedback ---
    function checkAnswer(selected) {
      // Increase total questions count on every answer attempt.
      totalQuestions++;

      const feedbackImage = document.getElementById("feedbackImage");
      const gameContainer = document.getElementById("gameContainer");
      // Regardless of mode, hide both the diagram and equation containers.
      document.getElementById("diagramContainer").style.display = "none";
      document.getElementById("equationContainer").style.display = "none";
      document.getElementById("optionsContainer").style.display = "none";
      
      if (selected === correctAnswer) {
        score++;
        consecutiveCorrect++;
        feedbackImage.src = pickRandomImage(happyImages);
        // Reveal the next tile in the rainbow unicorn puzzle (if available)
        if (revealedTiles < totalTiles) {
          const puzzle = document.getElementById('rainbowPuzzle');
          // Use the shuffled tileOrder array for a random reveal order.
          const tileIndex = tileOrder[revealedTiles];
          puzzle.children[tileIndex].style.visibility = 'visible';
          revealedTiles++;
        }
      } else {
        consecutiveCorrect = 0;
        feedbackImage.src = pickRandomImage(sadImages);
      }

      feedbackImage.style.display = "block";

      // If 5 correct in a row, trigger a celebratory visual effect.
      if (selected === correctAnswer && consecutiveCorrect === 5) {
        gameContainer.classList.add("celebrate-effect");
        setTimeout(() => {
          gameContainer.classList.remove("celebrate-effect");
        }, 1000);
        consecutiveCorrect = 0; // reset counter
      }
      
      // Update the score display to show "correct / total"
      document.getElementById("scoreText").textContent = "Score: " + score + " / " + totalQuestions;
      
      // After 2 seconds, move to the next problem.
      setTimeout(generateProblem, 2000);
    }

    // --- Initialize the Game ---
    window.onload = () => {
      initializeRainbowPuzzle();  // Build the rainbow unicorn puzzle grid and randomize tile order
      generateProblem();
    };
  </script>
</body>
</html>
